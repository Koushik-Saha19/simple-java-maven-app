pipeline {
    agent any
    tools {
        maven 'LocalMVN'
        jdk 'LocalJDK'
    }
    stages {
        stage ('Jmeter Test') {
            steps {
                sh '/opt/jmeter/apache-jmeter-5.2.1/bin/jmeter.sh -Jjmeter.save.saveservice.output_format=xml -n -t /home/ubuntu/test.jmx -l /opt/jmeter/apache-jmeter-5.2.1/bin/report2.jtl'
                sh 'cd /opt/jmeter/apache-jmeter-5.2.1/bin && mv report2.jtl /var/lib/jenkins/workspace/pipeline-job-3'
                sh 'perfReport filterRegex: "" sourceDataFiles: '/opt/jmeter/apache-jmeter-5.2.1/bin/report2.jtl''
        
            }
            
        }
    }
    post {
        always {
            step([$class: 'ArtifactArchiver', artifacts: '**/*.jtl'])
        }
    }
  
}
